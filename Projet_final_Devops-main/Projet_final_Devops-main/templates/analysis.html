<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Donn√©es | Scraping Immobilier</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">üìà Analyse des Donn√©es</h1>

        <!-- Expander -->
        <div class="alert alert-info">
            <strong>‚ÑπÔ∏è √Ä propos de cette page :</strong>  
            Cette page permet d'afficher et d'explorer les **donn√©es r√©cup√©r√©es via le web scraping**.  
            Vous pouvez ici **visualiser les annonces collect√©es** avant leur traitement.
        </div>

        <!-- S√©lection du dataset -->
        <div class="mb-3">
            <label for="dataset" class="form-label">S√©lectionnez un dataset :</label>
            <select class="form-select" id="dataset">
                <option value="Appartements √† louer non pr√©trait√©">Appartements √† louer non pr√©trait√©</option>
                <option value="Appartements meubl√©s non pr√©trait√©">Appartements meubl√©s non pr√©trait√©</option>
                <option value="Terrains √† vendre non pr√©trait√©">Terrains √† vendre non pr√©trait√©</option>
            </select>
        </div>

        <!-- Bouton pour charger les donn√©es -->
        <button class="btn btn-primary w-100" id="loadDataBtn">üìÇ Charger les donn√©es</button>

        <!-- Zone d'affichage des r√©sultats -->
        <div id="dataContainer" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById("loadDataBtn").addEventListener("click", function() {
            let dataset = document.getElementById("dataset").value;
            let dataContainer = document.getElementById("dataContainer");

            dataContainer.innerHTML = "<div class='text-center'><div class='spinner-border' role='status'></div> Chargement...</div>";

            fetch(`/load_data?dataset=${dataset}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        dataContainer.innerHTML = `<div class='alert alert-danger'>üö® ${data.error}</div>`;
                    } else {
                        let tableHTML = "<table class='table table-striped'><thead><tr>";

                        // G√©n√©rer les en-t√™tes
                        let keys = Object.keys(data.data[0]);
                        keys.forEach(key => tableHTML += `<th>${key}</th>`);
                        tableHTML += "</tr></thead><tbody>";

                        // Ajouter les lignes du tableau
                        data.data.forEach(row => {
                            tableHTML += "<tr>";
                            keys.forEach(key => tableHTML += `<td>${row[key]}</td>`);
                            tableHTML += "</tr>";
                        });

                        tableHTML += "</tbody></table>";
                        dataContainer.innerHTML = tableHTML;
                    }
                })
                .catch(error => {
                    dataContainer.innerHTML = `<div class='alert alert-danger'>Erreur lors du chargement des donn√©es.</div>`;
                });
        });
    </script>
</body>
</html>
